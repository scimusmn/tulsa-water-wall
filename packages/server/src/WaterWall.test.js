const WaterWall = require('./WaterWall.js');
const DefaultDrawings = require('./DefaultDrawings.js');

function MockArduino() {
  this.open = jest.fn().mockResolvedValue();
  this.on = jest.fn((key, cb) => {});
  this.send = jest.fn((key, value) => {});
}


const ArrayEncode = require('./ArrayEncode.js');


const drawing1 = [
  '001100000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000110011001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000001100110000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000011001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000110000110000011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000110000001111110000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000001111000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000001111110000011111100000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000011001100000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000011111000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000011001100000110000000011000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000011001100110000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000001111111100000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000110011000000001100000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000011110000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000110011000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000001100001100000110000000000000000000000000000000',
  '000000000000000000000010000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000',
  '000000000000000000000010000000000000000000000000000000000000000000000000000000000000000110001000000000000000000000000000',
  '000000000000000000000111000000000000000000000000000000000000000000000000000000000000000111111000001100000000000000000000',
  '000000000000000000001111100000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000',
  '000000000000000000011111110000000000000000000000000000000000000000000000000000000000000000000000001100010000011000000000',
  '000000000000000000111111111000000000000000000000000000000000000000000000000000000000000000000000001111110000011000000000',
  '000000000000000000111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000',
  '000000000000000000001111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000011000000000',
  '000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000001110000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000011111000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000111111100000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000001111111110000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000001111111110000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000011111000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000001111100000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000011111110000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000111111111000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000111111111000000000000000000000000000000000000001000000000000000000000000000000000000',
  '000000000000000000000000000000000000001111100000000000000000000000000000000000000001000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000011100000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000111110000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000001111111000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000011111111100000000000000000000000000000000',
  '000000000000100000000000000000000000000000000000000000000000000000000000000000011111111100000000000000000000000000000000',
  '000000000000100000000000000000000000000000000000000000000000000000000000000000000111110000000000000000000000000000000000',
  '000000000001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000011111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000111111100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000',
  '000000001111111110000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000',
  '000000001111111110000000000000000000000000000000000000001110000000000000000000000000000000000000000000000000000000000000',
  '000000000011111000000000000000000000000000000000000000011111000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000111111100000000000000000000000000000000000000000000000100000000000',
  '000000000000000000000000000000000000000000000000000001111111110000000000000000000000000000000000000000000000100000000000',
  '000000000000000000000000000000000000000000000000000001111111110000000000000000000000000000000000000000000001110000000000',
  '000000000000000000000000000000000000000000000000000000011111000000000000000000000000000000000000000000000011111000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000111111100000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000001111111110000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000111000000000000000001111111110000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000001111100000000000000000011111000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000011111110000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000001111100000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
];


const drawing2 = [
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000111111100000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000111111100000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000111111100000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000111111100000000000000000000000000000000000000000000000000000000',
  '111111111111111111111111000000000000000000000000000001111111111111110000000000000000000000000000000000000000000000000000',
  '111111111111111111111111111100000000000000000000111111111111111111111111000000000000000000000000000000000000000000000000',
  '111111111111111111111111111111110000000000001111111111111111111111111111111100000000000011111111111111111111111111111111',
  '111111111111111111111111111100000000000011111111111111111111111111111111111111110000000000001111111111111111111111111111',
  '111111111111111111111111000000000000111111111111111111111111111111111111111111111111000000000000111111111111111111111111',
  '111111111111111111110000000000001111111111111111111111111111111111111111111111111111111100000000000011111111111111111111',
  '111111111111111100000000000011111111111111111111111111111111111111111111111111111111111111110000000000001111111111111111',
  '111111111111000000000000111111111111111111111111111111111111111111111111111111111111111111111111000000000000111111111111',
  '000000001111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111100000000',
  '000011111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111111110000',
  '111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111',
  '111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111',
  '111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
  '111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111',
];


const drawing3 = [
  '111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000111',
  '011111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000001110',
  '001111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000111000',
  '000111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000000011100000',
  '000011111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000111000000',
  '000001111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000011100000000',
  '000000111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000001110000000000',
  '000000011111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000011100000000000',
  '000000001111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000001110000000000000',
  '000000000111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000111000000000000000',
  '000000000011111111111111111111111111111111111111111000000000000000000000000000000000000000000000000001110000000000000000',
  '000000000001111111111111111111111111111111111111111100000000000000000000000000000000000000000000000111000000000000000000',
  '000000000000111111111111111111111111111111111111111110000000000000000000000000000000000000000000011100000000000000000000',
  '000000000000011111111111111111111111111111111111111111000000000000000000000000000000000000000000111000000000000000000000',
  '000000000000001111111111111111111111111111111111111111100000000000000000000000000000000000000011100000000000000000000000',
  '000000000000000111111111111111111111111111111111111111110000000000000000000000000000000000001110000000000000000000000000',
  '000000000000000011111111111111111111111111111111111111111000000000000000000000000000000000011100000000000000000000000000',
  '000000000000000001111111111111111111111111111111111111111100000000000000000000000000000001110000000000000000000000000000',
  '000000000000000000111111111111111111111111111111111111111110000000000000000000000000000111000000000000000000000000000000',
  '000000000000000000011111111111111111111111111111111111111111000000000000000000000000001110000000000000000000000000000000',
  '000000000000000000001111111111111111111111111111111111111111100000000000000000000000111000000000000000000000000000000000',
  '000000000000000000000111111111111111111111111111111111111111110000000000000000000011100000000000000000000000000000000000',
  '000000000000000000000011111111111111111111111111111111111111111000000000000000000111000000000000000000000000000000000000',
  '000000000000000000000001111111111111111111111111111111111111111100000000000000011100000000000000000000000000000000000000',
  '000000000000000000000000111111111111111111111111111111111111111110000000000001110000000000000000000000000000000000000000',
  '000000000000000000000000011111111111111111111111111111111111111111000000000011100000000000000000000000000000000000000000',
  '000000000000000000000000001111111111111111111111111111111111111111100000001110000000000000000000000000000000000000000000',
  '000000000000000000000000000111111111111111111111111111111111111111110000111000000000000000000000000000000000000000000000',
  '000000000000000000000000000011111111111111111111111111111111111111111001110000000000000000000000000000000000000000000000',
  '000000000000000000000000000001111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000011111111111111111111111111111111111111111000000000000000000000000000000000000000000000000',
  '000000000000000000000000000000001111111111111111111111111111111111111111100000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000011111111111111111111111111111111111111111000000000000000000000000000000000000000000000',
  '000000000000000000000000000000000001111111111111111111111111111111111111111100000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000011111111111111111111111111111111111111111000000000000000000000000000000000000000000',
  '000000000000000000000000000000000000001111111111111111111111111111111111111111100000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000011111111111111111111111111111111111111111000000000000000000000000000000000000000',
  '000000000000000000000000000000000000000001111111111111111111111111111111111111111100000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000011111111111111111111111111111111111111111000000000000000000000000000000000000',
  '000000000000000000000000000000000000000000001111111111111111111111111111111111111111100000000000000000000000000000000000',
  '000000000000000000000000000000000000000000111111111111111111111111111111111111111111110000000000000000000000000000000000',
  '000000000000000000000000000000000000000001110011111111111111111111111111111111111111111000000000000000000000000000000000',
  '000000000000000000000000000000000000000111000001111111111111111111111111111111111111111100000000000000000000000000000000',
  '000000000000000000000000000000000000011100000000111111111111111111111111111111111111111110000000000000000000000000000000',
  '000000000000000000000000000000000000111000000000011111111111111111111111111111111111111111000000000000000000000000000000',
  '000000000000000000000000000000000011100000000000001111111111111111111111111111111111111111100000000000000000000000000000',
  '000000000000000000000000000000001110000000000000000111111111111111111111111111111111111111110000000000000000000000000000',
  '000000000000000000000000000000011100000000000000000011111111111111111111111111111111111111111000000000000000000000000000',
  '000000000000000000000000000001110000000000000000000001111111111111111111111111111111111111111100000000000000000000000000',
  '000000000000000000000000000111000000000000000000000000111111111111111111111111111111111111111110000000000000000000000000',
  '000000000000000000000000001110000000000000000000000000011111111111111111111111111111111111111111000000000000000000000000',
  '000000000000000000000000111000000000000000000000000000001111111111111111111111111111111111111111100000000000000000000000',
  '000000000000000000000011100000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000000',
  '000000000000000000000111000000000000000000000000000000000011111111111111111111111111111111111111111000000000000000000000',
  '000000000000000000011100000000000000000000000000000000000001111111111111111111111111111111111111111100000000000000000000',
  '000000000000000001110000000000000000000000000000000000000000111111111111111111111111111111111111111110000000000000000000',
  '000000000000000011100000000000000000000000000000000000000000011111111111111111111111111111111111111111000000000000000000',
  '000000000000001110000000000000000000000000000000000000000000001111111111111111111111111111111111111111100000000000000000',
  '000000000000111000000000000000000000000000000000000000000000000111111111111111111111111111111111111111110000000000000000',
  '000000000001110000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111000000000000000',
  '000000000111000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111100000000000000',
  '000000011100000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111110000000000000',
  '000000111000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111000000000000',
  '000011100000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111100000000000',
  '001110000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111110000000000',
  '011100000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111000000000',
  '110000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111100000000',
  '100000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111110000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111000000',
  '000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111100000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111110000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111000',
  '000000000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111111111111111111111100',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111110',
  '000000000000000000000000000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111',
];


function toArrayOfArrays(drawing) {
  return drawing.map(
    line => 
      line.split('').map(x => Number(x))
  );
}


function toEncoded(drawing) {
  return toArrayOfArrays(drawing).map(lineArray => ArrayEncode(lineArray));
}


const testDrawings = [ toEncoded(drawing1), toEncoded(drawing2), toEncoded(drawing3) ];



test('WaterWall.open() correctly sets up arduino', () => {
  const wall = new WaterWall();
  const mockArduino = new MockArduino();
  wall.arduino = mockArduino;

  return wall.open().then(() => {
    expect(mockArduino.open.mock.calls.length).toBe(1);
    expect(mockArduino.on.mock.calls.length).toBe(2);

    expect(mockArduino.on.mock.calls[0][0]).toBe('rx-ready');
    expect(mockArduino.on.mock.calls[0][1]).toBe(wall.onRxReady);

    expect(mockArduino.on.mock.calls[1][0]).toBe('acknowledge-line');
    expect(mockArduino.on.mock.calls[1][1]).toBe(wall.onAcknowledgeLine);
  });
});


test('WaterWall correctly sends data', () => {
  const wall = new WaterWall();
  wall.DefaultDrawings = testDrawings;
  
  const mockArduino = new MockArduino();
  wall.arduino = mockArduino;

  expect(mockArduino.send.mock.calls.length).toBe(0);

  wall.onRxReady('1');
  wall.onRxReady('1'); // shouldn't do anything until drawing fully transmitted
  wall.onRxReady('1');
  for (let i=0; i<80; i++) {
    wall.onAcknowledgeLine();
  }

  expect(mockArduino.send.mock.calls.length).toBe(82);
  expect(mockArduino.send.mock.calls[0][0]).toBe('begin-drawing');
  expect(mockArduino.send.mock.calls[0][1]).toBe('1');

  for (let i=1; i<81; i++) {
    expect(mockArduino.send.mock.calls[i][0]).toBe('line');
    expect(mockArduino.send.mock.calls[i][1]).toBe(DefaultDrawings[0][80-i]);
  }

  expect(mockArduino.send.mock.calls[81][0]).toBe('publish-drawing');
  expect(mockArduino.send.mock.calls[81][1]).toBe('1');
});


function matchDrawing(mockArduino, offset, drawing) {
  const o = offset * (drawing.length+2);
  
  expect(mockArduino.send.mock.calls[o][0]).toBe('begin-drawing');
  expect(mockArduino.send.mock.calls[o][1]).toBe('1');

  for (let i=0; i<drawing.length; i++) {
    expect(mockArduino.send.mock.calls[o+i+1][0]).toBe('line');
    expect(mockArduino.send.mock.calls[o+i+1][1]).toBe(drawing[drawing.length-i-1]);
  }

  expect(mockArduino.send.mock.calls[o+drawing.length+1][0]).toBe('publish-drawing');
  expect(mockArduino.send.mock.calls[o+drawing.length+1][1]).toBe('1');
}


test('WaterWall iterates over all default drawings', () => {
  const wall = new WaterWall();
  wall.DefaultDrawings = testDrawings;
  wall.arduino = new MockArduino();

  wall.onRxReady('1');
  for (let i=0; i<80; i++)
    wall.onAcknowledgeLine();

  wall.onRxReady('0');
  wall.onRxReady('1');
  for (let i=0; i<80; i++)
    wall.onAcknowledgeLine();

  wall.onRxReady('0');
  wall.onRxReady('1');
  for (let i=0; i<80; i++)
    wall.onAcknowledgeLine();

  wall.onRxReady('0');
  wall.onRxReady('1');
  for (let i=0; i<80; i++)
    wall.onAcknowledgeLine();

  expect(wall.arduino.send.mock.calls.length).toBe(82*4);

  matchDrawing(wall.arduino, 0, DefaultDrawings[0]);
  matchDrawing(wall.arduino, 1, DefaultDrawings[1]);
  matchDrawing(wall.arduino, 2, DefaultDrawings[2]);
  matchDrawing(wall.arduino, 3, DefaultDrawings[0]);
});


test('WaterWall correctly queues and displays drawing received during transmission', () => {
  const wall = new WaterWall();
  wall.DefaultDrawings = testDrawings;
  wall.arduino = new MockArduino();

  wall.onRxReady('1');
  for (let i=0; i<40; i++)
    wall.onAcknowledgeLine();

  //insert new
  wall.push(DefaultDrawings[2]);

  for (let i=40; i<80; i++)
    wall.onAcknowledgeLine();

  wall.onRxReady('0');
  wall.onRxReady('1');
  for (let i=0; i<80; i++)
    wall.onAcknowledgeLine();

  wall.onRxReady('0');
  wall.onRxReady('1');
  for (let i=0; i<80; i++)
    wall.onAcknowledgeLine();

  wall.onRxReady('0');
  wall.onRxReady('1');
  for (let i=0; i<80; i++)
    wall.onAcknowledgeLine();

  expect(wall.arduino.send.mock.calls.length).toBe(82*4);

  matchDrawing(wall.arduino, 0, DefaultDrawings[0]);
  matchDrawing(wall.arduino, 1, DefaultDrawings[2]);
  matchDrawing(wall.arduino, 2, DefaultDrawings[1]);
  matchDrawing(wall.arduino, 3, DefaultDrawings[2]);
});
